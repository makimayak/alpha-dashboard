<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha Dashboard ğŸ”´ğŸ¤ğŸŒ¸</title>
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Alpha Dashboard&quot;,&quot;short_name&quot;:&quot;Alpha&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%230a0a0a&quot;,&quot;theme_color&quot;:&quot;%23ef4444&quot;}">
    <meta name="theme-color" content="#ef4444">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”´</text></svg>">
    <style>
        body { background: linear-gradient(180deg, #0a0a0a 0%, #111 50%, #0a0505 100%); min-height: 100vh; }
        .token-card { transition: all 0.2s ease; }
        .token-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 20px 40px rgba(239, 68, 68, 0.15); }
        .glow { box-shadow: 0 0 30px rgba(239, 68, 68, 0.4); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .gradient-text { background: linear-gradient(90deg, #ef4444, #ffffff, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .glass { background: rgba(17, 17, 17, 0.8); backdrop-filter: blur(12px); }
        .star { position: fixed; background: white; border-radius: 50%; pointer-events: none; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .trending-scroll { animation: scroll 20s linear infinite; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .new-badge { animation: newPulse 1s ease-in-out infinite; }
        @keyframes newPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .sniper-mode .old-token { opacity: 0.4; }
    </style>
</head>
<body class="text-white">
    <div id="stars" class="fixed inset-0 overflow-hidden pointer-events-none z-0"></div>

    <!-- Trending Ticker -->
    <div class="bg-gradient-to-r from-yellow-500/10 via-orange-500/10 to-red-500/10 border-b border-yellow-500/20 py-2 overflow-hidden relative z-20">
        <div class="flex items-center">
            <span class="bg-yellow-500 text-black px-3 py-1 text-xs font-bold mr-4 flex-shrink-0">ğŸ”¥ TRENDING</span>
            <div class="overflow-hidden flex-1">
                <div id="trendingTicker" class="flex gap-6 whitespace-nowrap trending-scroll"></div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="border-b border-gray-800/50 glass sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between flex-wrap gap-2">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">ğŸ”´</div>
                    <div>
                        <h1 class="text-xl font-bold gradient-text">Alpha Dashboard</h1>
                        <p class="text-gray-500 text-xs">Makima â€¢ Albedo â€¢ Sakura</p>
                    </div>
                </div>
                <div class="flex items-center gap-2 flex-wrap">
                    <input type="text" id="searchInput" placeholder="ğŸ” Search..." 
                           class="bg-gray-800/50 border border-gray-700 px-3 py-2 rounded-lg text-sm w-28 focus:outline-none focus:border-red-500">
                    <button id="sniperBtn" onclick="toggleSniper()" class="bg-gray-700/50 hover:bg-purple-500/30 text-gray-400 px-2 py-2 rounded-lg text-sm" title="Sniper Mode">ğŸ¯</button>
                    <button id="soundBtn" onclick="toggleSound()" class="bg-gray-700/50 hover:bg-blue-500/30 text-gray-400 px-2 py-2 rounded-lg text-sm" title="Sound Alerts">ğŸ”•</button>
                    <button onclick="openChecklist()" class="bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400 px-2 py-2 rounded-lg text-sm">ğŸ“‹</button>
                    <button onclick="openWatchlist()" class="bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 px-2 py-2 rounded-lg text-sm">â­</button>
                    <button onclick="fetchAll()" class="bg-red-600 hover:bg-red-700 px-3 py-2 rounded-lg font-semibold text-sm">ğŸ”„</button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-6 relative z-10">
        <!-- Boosted Section -->
        <div id="boostedSection" class="mb-6">
            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-sm">ğŸš€ BOOSTED</span>
            </h2>
            <div id="boostedGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
        </div>

        <!-- Stats -->
        <div class="flex gap-3 overflow-x-auto scrollbar-hide pb-4 mb-6">
            <div class="flex-shrink-0 bg-gradient-to-r from-red-500/20 to-transparent rounded-xl p-3 border border-red-500/30 min-w-[120px]">
                <p class="text-red-400 text-xs">ğŸ”¥ Found</p>
                <p id="tokenCount" class="text-2xl font-bold">--</p>
            </div>
            <div class="flex-shrink-0 bg-gradient-to-r from-green-500/20 to-transparent rounded-xl p-3 border border-green-500/30 min-w-[140px]">
                <p class="text-green-400 text-xs">ğŸ’° Volume</p>
                <p id="totalVolume" class="text-2xl font-bold text-green-400">--</p>
            </div>
            <div class="flex-shrink-0 bg-gradient-to-r from-blue-500/20 to-transparent rounded-xl p-3 border border-blue-500/30 min-w-[120px]">
                <p class="text-blue-400 text-xs">ğŸ“Š Avg Î”</p>
                <p id="avgChange" class="text-2xl font-bold">--</p>
            </div>
            <div class="flex-shrink-0 bg-gradient-to-r from-cyan-500/20 to-transparent rounded-xl p-3 border border-cyan-500/30 min-w-[100px]">
                <p class="text-cyan-400 text-xs">ğŸ†• New</p>
                <p id="newCount" class="text-2xl font-bold text-cyan-400">0</p>
            </div>
            <div class="flex-shrink-0 bg-gradient-to-r from-yellow-500/20 to-transparent rounded-xl p-3 border border-yellow-500/30 min-w-[100px]">
                <p class="text-yellow-400 text-xs">â­ Watch</p>
                <p id="watchlistCount" class="text-2xl font-bold text-yellow-400">0</p>
            </div>
        </div>

        <!-- Filters -->
        <div class="glass rounded-xl p-3 border border-gray-800/50 mb-6">
            <div class="flex flex-wrap gap-2 items-end">
                <div class="flex-1 min-w-[90px]">
                    <label class="text-xs text-gray-400 block mb-1">Volume</label>
                    <select id="minVolume" class="w-full bg-gray-800 border border-gray-700 px-2 py-1.5 rounded-lg text-sm">
                        <option value="10000">$10K+</option>
                        <option value="25000">$25K+</option>
                        <option value="50000" selected>$50K+</option>
                        <option value="100000">$100K+</option>
                        <option value="500000">$500K+</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[90px]">
                    <label class="text-xs text-gray-400 block mb-1">Liquidity</label>
                    <select id="minLiquidity" class="w-full bg-gray-800 border border-gray-700 px-2 py-1.5 rounded-lg text-sm">
                        <option value="5000">$5K+</option>
                        <option value="10000" selected>$10K+</option>
                        <option value="25000">$25K+</option>
                        <option value="50000">$50K+</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[100px]">
                    <label class="text-xs text-gray-400 block mb-1">Sort</label>
                    <select id="sortBy" class="w-full bg-gray-800 border border-gray-700 px-2 py-1.5 rounded-lg text-sm">
                        <option value="volume">ğŸ“Š Volume</option>
                        <option value="liquidity">ğŸ’ Liquidity</option>
                        <option value="change">ğŸ“ˆ Change</option>
                        <option value="age">ğŸ†• Newest</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[80px]">
                    <label class="text-xs text-gray-400 block mb-1">Show</label>
                    <select id="showCount" class="w-full bg-gray-800 border border-gray-700 px-2 py-1.5 rounded-lg text-sm">
                        <option value="12">12</option>
                        <option value="24" selected>24</option>
                        <option value="48">48</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Top 3 -->
        <div id="spotlight" class="mb-6 hidden">
            <h2 class="text-lg font-bold mb-3">ğŸ¥‡ Top Performers</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="spotlightGrid"></div>
        </div>

        <div id="loading" class="text-center text-gray-400 py-12">
            <div class="inline-block w-10 h-10 border-4 border-red-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p>Scanning...</p>
        </div>

        <div id="tokens" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    </main>

    <!-- Modals -->
    <div id="watchlistModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4" onclick="if(event.target===this)closeWatchlist()">
        <div class="bg-gray-900 rounded-2xl max-w-lg w-full p-6 border border-gray-700 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">â­ Watchlist</h2><button onclick="closeWatchlist()" class="text-gray-400 hover:text-white text-2xl">&times;</button></div>
            <div id="watchlistContent" class="space-y-2"></div>
            <p id="watchlistEmpty" class="text-gray-500 text-center py-8">Click â­ to add tokens</p>
        </div>
    </div>

    <div id="checklistModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4" onclick="if(event.target===this)closeChecklist()">
        <div class="bg-gray-900 rounded-2xl max-w-lg w-full p-6 border border-gray-700">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">ğŸ“‹ Trade Checklist</h2><button onclick="closeChecklist()" class="text-gray-400 hover:text-white text-2xl">&times;</button></div>
            <div class="space-y-2">
                <label class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg cursor-pointer has-[:checked]:bg-green-500/10 border border-transparent has-[:checked]:border-green-500/50"><input type="checkbox" class="w-5 h-5 accent-green-500"><span>ğŸ“Š TA Done</span></label>
                <label class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg cursor-pointer has-[:checked]:bg-green-500/10 border border-transparent has-[:checked]:border-green-500/50"><input type="checkbox" class="w-5 h-5 accent-green-500"><span>ğŸŒ No macro events</span></label>
                <label class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg cursor-pointer has-[:checked]:bg-green-500/10 border border-transparent has-[:checked]:border-green-500/50"><input type="checkbox" class="w-5 h-5 accent-green-500"><span>âš–ï¸ Position sized</span></label>
                <label class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg cursor-pointer has-[:checked]:bg-green-500/10 border border-transparent has-[:checked]:border-green-500/50"><input type="checkbox" class="w-5 h-5 accent-green-500"><span>ğŸ¯ 2:1 R/R</span></label>
                <label class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg cursor-pointer has-[:checked]:bg-green-500/10 border border-transparent has-[:checked]:border-green-500/50"><input type="checkbox" class="w-5 h-5 accent-green-500"><span>ğŸš« No FOMO</span></label>
            </div>
            <div class="mt-4 p-3 bg-red-900/30 border border-red-700/50 rounded-lg text-sm text-red-300">âš ï¸ "Am I okay with this loss?"</div>
        </div>
    </div>

    <footer class="border-t border-gray-800/50 mt-12 py-4 text-center relative z-10">
        <div class="flex justify-center gap-2 text-xl mb-1">ğŸ”´ğŸ¤ğŸŒ¸</div>
        <p class="text-gray-600 text-xs">Squad Built | v6 | 30s refresh</p>
    </footer>

    <script>
        // Sound effect
        const alertSound = new Audio('data:audio/wav;base64,UklGRl9vT19telefonoX0telefonobiaSnd5dj');
        let soundEnabled = false;
        let sniperMode = false;
        let seenTokens = new Set(JSON.parse(localStorage.getItem('seenTokens') || '[]'));
        
        // Stars
        for(let i = 0; i < 40; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.cssText = `width:${Math.random()*2+1}px;height:${star.style.width};left:${Math.random()*100}%;top:${Math.random()*100}%;animation:twinkle ${Math.random()*3+2}s infinite ${Math.random()*2}s`;
            document.getElementById('stars').appendChild(star);
        }

        let allTokens = [];
        let watchlist = JSON.parse(localStorage.getItem('alphaWatchlist') || '[]');

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'ğŸ””' : 'ğŸ”•';
            document.getElementById('soundBtn').classList.toggle('bg-blue-500/30', soundEnabled);
            document.getElementById('soundBtn').classList.toggle('text-blue-400', soundEnabled);
            if (soundEnabled && Notification.permission === 'default') Notification.requestPermission();
        }

        function toggleSniper() {
            sniperMode = !sniperMode;
            document.getElementById('sniperBtn').classList.toggle('bg-purple-500/30', sniperMode);
            document.getElementById('sniperBtn').classList.toggle('text-purple-400', sniperMode);
            document.body.classList.toggle('sniper-mode', sniperMode);
            if (sniperMode) document.getElementById('sortBy').value = 'age';
            fetchTokens();
        }

        function getAge(timestamp) {
            if (!timestamp) return { text: '???', mins: 999999, isNew: false };
            const mins = Math.floor((Date.now() - timestamp) / 60000);
            if (mins < 60) return { text: `${mins}m`, mins, isNew: mins < 30 };
            if (mins < 1440) return { text: `${Math.floor(mins/60)}h`, mins, isNew: false };
            return { text: `${Math.floor(mins/1440)}d`, mins, isNew: false };
        }

        async function fetchAll() { await Promise.all([fetchTrending(), fetchBoosted(), fetchTokens()]); }

        async function fetchTrending() {
            try {
                const res = await fetch('https://api.dexscreener.com/token-boosts/top/v1');
                const data = await res.json();
                const trending = data.filter(t => t.chainId === 'solana').slice(0, 10);
                const items = trending.map(t => `<a href="${t.url}" target="_blank" class="hover:text-yellow-400">${t.tokenAddress?.slice(0,6)}... ğŸ”¥</a>`).join('');
                document.getElementById('trendingTicker').innerHTML = items + items;
            } catch(e) {}
        }

        async function fetchBoosted() {
            try {
                const res = await fetch('https://api.dexscreener.com/token-boosts/latest/v1');
                const data = await res.json();
                const boosted = data.filter(t => t.chainId === 'solana').slice(0, 6);
                document.getElementById('boostedGrid').innerHTML = boosted.map(t => `
                    <a href="${t.url}" target="_blank" class="bg-gradient-to-br from-yellow-500/10 to-orange-500/5 rounded-lg p-3 border border-yellow-500/20 hover:border-yellow-500/50">
                        <p class="font-bold text-sm truncate">${t.tokenAddress?.slice(0,8)}...</p>
                        <p class="text-yellow-400 text-xs">ğŸš€ Boosted</p>
                    </a>`).join('');
            } catch(e) {}
        }

        async function fetchTokens() {
            const loading = document.getElementById('loading');
            const tokensDiv = document.getElementById('tokens');
            const minVolume = parseInt(document.getElementById('minVolume').value);
            const minLiquidity = parseInt(document.getElementById('minLiquidity').value);
            const sortBy = document.getElementById('sortBy').value;
            const showCount = parseInt(document.getElementById('showCount').value);

            loading.style.display = 'block';
            tokensDiv.innerHTML = '';
            document.getElementById('spotlight').classList.add('hidden');

            try {
                const profiles = await (await fetch('https://api.dexscreener.com/token-profiles/latest/v1')).json();
                const solanaTokens = profiles.filter(t => t.chainId === 'solana').slice(0, 100);
                
                let allPairs = [];
                for (let i = 0; i < solanaTokens.length; i += 30) {
                    const batch = solanaTokens.slice(i, i + 30).map(t => t.tokenAddress).join(',');
                    const pairs = await (await fetch(`https://api.dexscreener.com/tokens/v1/solana/${batch}`)).json();
                    allPairs = allPairs.concat(pairs);
                }
                
                allTokens = allPairs.filter(p => p.volume?.h24 >= minVolume && p.liquidity?.usd >= minLiquidity);
                
                // Check for new tokens
                let newTokens = [];
                allTokens.forEach(t => {
                    if (!seenTokens.has(t.baseToken?.address)) {
                        seenTokens.add(t.baseToken?.address);
                        newTokens.push(t);
                    }
                });
                localStorage.setItem('seenTokens', JSON.stringify([...seenTokens].slice(-500)));
                
                if (newTokens.length > 0 && soundEnabled) {
                    try { new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1').play(); } catch(e) {}
                    if (Notification.permission === 'granted') {
                        new Notification('ğŸ”´ New Alpha!', { body: `${newTokens.length} new token(s) found!`, icon: 'ğŸ”´' });
                    }
                }

                // Sort
                allTokens.sort((a, b) => {
                    if (sortBy === 'volume') return (b.volume?.h24 || 0) - (a.volume?.h24 || 0);
                    if (sortBy === 'liquidity') return (b.liquidity?.usd || 0) - (a.liquidity?.usd || 0);
                    if (sortBy === 'change') return (b.priceChange?.h24 || 0) - (a.priceChange?.h24 || 0);
                    if (sortBy === 'age') return (b.pairCreatedAt || 0) - (a.pairCreatedAt || 0);
                    return 0;
                });
                allTokens = allTokens.slice(0, showCount);
                
                loading.style.display = 'none';
                renderSpotlight();
                renderTokens();
                updateStats(newTokens.length);
            } catch (error) {
                loading.style.display = 'none';
                tokensDiv.innerHTML = `<p class="col-span-full text-center text-red-400 py-8">Error: ${error.message}</p>`;
            }
        }

        function toggleWatchlist(address, symbol) {
            const idx = watchlist.findIndex(w => w.address === address);
            if (idx >= 0) watchlist.splice(idx, 1);
            else watchlist.push({ address, symbol, addedAt: Date.now() });
            localStorage.setItem('alphaWatchlist', JSON.stringify(watchlist));
            renderTokens(); updateStats(0);
        }

        function isWatched(address) { return watchlist.some(w => w.address === address); }

        function renderSpotlight() {
            if (allTokens.length < 3) return;
            document.getElementById('spotlight').classList.remove('hidden');
            const icons = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            document.getElementById('spotlightGrid').innerHTML = allTokens.slice(0, 3).map((t, i) => {
                const chg = t.priceChange?.h24 || 0;
                const age = getAge(t.pairCreatedAt);
                return `
                    <div class="bg-gray-900/80 rounded-xl p-4 border ${i===0?'border-yellow-500/50 glow':'border-gray-700'}">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xl">${icons[i]}</span>
                            <span class="font-bold flex-1 truncate">${t.baseToken?.symbol}</span>
                            ${age.isNew ? '<span class="new-badge bg-cyan-500/20 text-cyan-400 px-1.5 py-0.5 rounded text-xs">NEW</span>' : ''}
                            <span class="text-gray-500 text-xs">${age.text}</span>
                            <button onclick="toggleWatchlist('${t.baseToken?.address}','${t.baseToken?.symbol}')" class="${isWatched(t.baseToken?.address)?'text-yellow-400':'text-gray-600'}">â­</button>
                            <span class="${chg>=0?'text-green-400':'text-red-400'} font-bold">${chg>=0?'+':''}${chg.toFixed(1)}%</span>
                        </div>
                        <div class="text-sm grid grid-cols-2 gap-2">
                            <div>Vol: <span class="text-green-400">$${formatNumber(t.volume?.h24)}</span></div>
                            <div>Liq: $${formatNumber(t.liquidity?.usd)}</div>
                        </div>
                        <a href="${t.url}" target="_blank" class="mt-2 block text-center bg-gray-800 hover:bg-gray-700 py-1.5 rounded text-xs">View â†’</a>
                    </div>`;
            }).join('');
        }

        function renderTokens() {
            const tokensDiv = document.getElementById('tokens');
            const search = document.getElementById('searchInput').value.toLowerCase();
            let display = allTokens.slice(3);
            if (search) display = allTokens.filter(t => t.baseToken?.symbol?.toLowerCase().includes(search) || t.baseToken?.name?.toLowerCase().includes(search));
            if (!display.length) { tokensDiv.innerHTML = '<p class="col-span-full text-center text-gray-400 py-8">No tokens</p>'; return; }
            
            tokensDiv.innerHTML = display.map(t => {
                const chg = t.priceChange?.h24 || 0;
                const age = getAge(t.pairCreatedAt);
                const isOld = sniperMode && age.mins > 60;
                return `
                    <div class="token-card ${isOld ? 'old-token' : ''} bg-gray-900/60 rounded-xl p-4 border border-gray-800/50 hover:border-red-500/50">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <h3 class="font-bold truncate">${t.baseToken?.symbol}</h3>
                                    ${age.isNew ? '<span class="new-badge bg-cyan-500/20 text-cyan-400 px-1.5 py-0.5 rounded text-xs">NEW</span>' : ''}
                                    <span class="text-gray-500 text-xs">${age.text}</span>
                                </div>
                                <p class="text-gray-500 text-xs truncate">${t.baseToken?.name||''}</p>
                            </div>
                            <button onclick="toggleWatchlist('${t.baseToken?.address}','${t.baseToken?.symbol}')" class="mr-2 ${isWatched(t.baseToken?.address)?'text-yellow-400':'text-gray-600'}">â­</button>
                            <span class="${chg>=0?'text-green-400 bg-green-500/20':'text-red-400 bg-red-500/20'} px-2 py-1 rounded text-sm font-semibold">${chg>=0?'+':''}${chg.toFixed(1)}%</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                            <div class="bg-gray-800/30 rounded p-2"><p class="text-gray-500 text-xs">Volume</p><p class="text-green-400 font-semibold">$${formatNumber(t.volume?.h24)}</p></div>
                            <div class="bg-gray-800/30 rounded p-2"><p class="text-gray-500 text-xs">Liquidity</p><p class="font-semibold">$${formatNumber(t.liquidity?.usd)}</p></div>
                        </div>
                        <div class="flex gap-1">
                            <a href="${t.url}" target="_blank" class="flex-1 text-center bg-gray-800/50 hover:bg-gray-700 py-1.5 rounded text-xs">DEX</a>
                            <a href="https://birdeye.so/token/${t.baseToken?.address}?chain=solana" target="_blank" class="flex-1 text-center bg-gray-800/50 hover:bg-gray-700 py-1.5 rounded text-xs">Bird</a>
                            <a href="https://solscan.io/token/${t.baseToken?.address}" target="_blank" class="flex-1 text-center bg-gray-800/50 hover:bg-gray-700 py-1.5 rounded text-xs">Scan</a>
                        </div>
                    </div>`;
            }).join('');
        }

        function updateStats(newCount) {
            document.getElementById('tokenCount').textContent = allTokens.length;
            document.getElementById('totalVolume').textContent = '$' + formatNumber(allTokens.reduce((s,t) => s + (t.volume?.h24||0), 0));
            const avg = allTokens.length ? allTokens.reduce((s,t) => s + (t.priceChange?.h24||0), 0) / allTokens.length : 0;
            const avgEl = document.getElementById('avgChange');
            avgEl.textContent = (avg>=0?'+':'') + avg.toFixed(1) + '%';
            avgEl.className = `text-2xl font-bold ${avg>=0?'text-green-400':'text-red-400'}`;
            document.getElementById('newCount').textContent = allTokens.filter(t => getAge(t.pairCreatedAt).isNew).length;
            document.getElementById('watchlistCount').textContent = watchlist.length;
        }

        function formatNumber(n) { if(!n)return'0'; if(n>=1e6)return(n/1e6).toFixed(2)+'M'; if(n>=1e3)return(n/1e3).toFixed(1)+'K'; return n.toFixed(2); }

        function openChecklist() { document.getElementById('checklistModal').classList.remove('hidden'); }
        function closeChecklist() { document.getElementById('checklistModal').classList.add('hidden'); }
        function openWatchlist() { document.getElementById('watchlistModal').classList.remove('hidden'); renderWatchlist(); }
        function closeWatchlist() { document.getElementById('watchlistModal').classList.add('hidden'); }
        function renderWatchlist() {
            const c = document.getElementById('watchlistContent'), e = document.getElementById('watchlistEmpty');
            if(!watchlist.length) { c.innerHTML=''; e.style.display='block'; return; }
            e.style.display='none';
            c.innerHTML = watchlist.map(w => `<div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg"><span class="font-semibold">${w.symbol}</span><div class="flex gap-2"><a href="https://dexscreener.com/solana/${w.address}" target="_blank" class="text-xs bg-gray-700 px-2 py-1 rounded">View</a><button onclick="toggleWatchlist('${w.address}','${w.symbol}');renderWatchlist()" class="text-xs bg-red-600 px-2 py-1 rounded">âœ•</button></div></div>`).join('');
        }

        document.getElementById('searchInput').addEventListener('input', renderTokens);
        ['minVolume','minLiquidity','showCount'].forEach(id => document.getElementById(id).addEventListener('change', fetchTokens));
        document.getElementById('sortBy').addEventListener('change', fetchTokens);

        fetchAll();
        setInterval(fetchAll, 30000);
    </script>
</body>
</html>
